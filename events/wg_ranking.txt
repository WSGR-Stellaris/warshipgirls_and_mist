namespace = wsgranking
# 创建国家

event = {
    id = wsgranking.1919
    hide_window = yes
    is_triggered_only = yes
    fire_only_once = yes    

    # 只在有舰娘国家才执行
    trigger = {
        any_country = { 
            OR = {
                has_authority = auth_shenhai
                has_authority = auth_warshipgirls
            }
            is_ai = no
        }
        NOT = { has_global_flag = pantsu_shop_created }
    }

    immediate = {
        create_species = {
			name = "NAME_pantsu_shop_species"
			class = "Warship_Girls"
			portrait = "Warship_girls"
			traits = random
			immortal = yes
			effect = { }
		}
		create_country = {
			name = "NAME_pantsu_shop"
			species = last_created_species
			type = pantsu_shop
			name_list = "WSG"
			# 旗子，让海豹自己改
			flag = {
				icon = {
					category = "wg_event_flags"
					file = "wge_flags_01.dds"
				}
				background= {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors={
					"blue"
					"black"
					"null"
					"null"
				}
			}
			ignore_initial_colony_error = yes
			effect = {
				save_global_event_target_as = pantsu_shop_country
				# 加基地设计，创建恒星基地用
				create_ship_design = { design = "NAME_pantsu_shop_station" }
				add_ship_design = last_created_design
                set_country_flag = no_origin
				# 防止掠夺者打商店
                # 掠夺者打不过这个商店，让他们尽管送死好了
				# every_country = {
				# 	limit = { is_country_type = dormant_marauders }
				# 	set_faction_hostility = {
				# 		target = prev
				# 		set_hostile = no 
				# 		set_neutral = no
				# 		set_friendly = yes
				# 	}
                # }
                # 设置变量
                set_variable = { which = dark_matter_stock value = 30000 }
                set_variable = { which = living_metal_stock value = 30000 }
                set_variable = { which = zro_stock value = 30000 }
                set_variable = { which = nanite_stock value = 10000 }
                set_variable = { which = alpha_stock value = 20000 }
                set_variable = { which = se_stock value = 20000 }
                set_variable = { which = rings_stock value = 3 }
			}
		}
        random_country = {
            limit = {
                OR = {
                    has_authority = auth_shenhai
                    has_authority = auth_warshipgirls
                }
                is_ai = no
            }
            set_global_flag = pantsu_shop_created
            capital_scope = {
                closest_system = {
                    min_steps = 8
                    spawn_system = {
                        min_jumps = 1
                        max_jumps = 3
                        hyperlane = yes
                        initializer = "shop_system" 
                    }
                }
            }
            event_target:pantsu_shop_system = {
                random_system_planet = {
                    create_pantsu_shop_guard_fleets = yes
                }
            }
        }
    }
    # save global event target 已经放进去了solar system initializer了，所以不用再save了
}

country_event = {
    id = wsgranking.810
    hide_window = yes
    is_triggered_only = yes
    fire_only_once = yes    

    trigger = {
        NOT = { has_global_flag = pantsu_shop_created }
    }

    immediate = {
        
    }
}

# 旧存档适配 （大概）
# 已经宣布了不适配旧存档所以大概不需要这个了
#event = {
#    id = wsgranking.810
#    hide_window = yes
#    fire_only_once = yes
#
#    trigger = {
#        NOT = { has_global_flag = pantsu_shop_created }
#    }
#
#    immediate = {
#        random_country = {
#            limit = { is_country_type = global_event }
#            country_event = { id = wsgranking.1919 }
#        }
#        # 旧存档如果已经有胖次科技直接联系
#        every_playable_country = {
#            limit = {
#                OR = {
#                    has_authority = auth_warshipgirls
#                    has_authority = auth_shenhai
#                }
#                has_technology = tech_wsg_pantsu
#                NOT = { has_communications = event_target:pantsu_shop_country }
#            }
#        }
#        set_country_flag = establish_communicate_in_normal
#        establish_communications_no_message = event_target:pantsu_shop_country
#        country_event = { id = wsgranking.1000 }
#    }
#}


# 有船路过胖次商店
# Scope = Ship
# From = System
# FromFrom = Country
ship_event = {
	id = wsgranking.996
	hide_window = yes
    is_triggered_only = yes

    trigger = {
        exists = event_target:pantsu_shop_country
        From = { has_star_flag = shop_system_home }
        FromFrom = { 
            is_country_type = default 
            NOT = { has_communications = event_target:pantsu_shop_country }
        }
    }

    immediate = {
        owner = {
            if = { 
                limit = { OR = {
                    has_authority = auth_warshipgirls
                    has_authority = auth_shenhai
                }}
                # 防止事件重复发生
                set_country_flag = establish_communicate_in_normal
                establish_communications_no_message = event_target:pantsu_shop_country
                country_event = { id = wsgranking.1000 }
                country_event = { id = wsgranking.20001 }
            }
            else = {
                establish_communications_no_message = event_target:pantsu_shop_country
                country_event = { id = wsgranking.997 }
            }
        }
    }
}

# 普通国家遇到胖次商店
country_event = {
	id = wsgranking.997
	title = "action.11.name"
    desc = wsgranking.997.desc

	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # 有需求的话自己改名字
		room = Shop_room
	}

    option = {
        name = wsgranking.997.a
    }

}

# 非正常原因与胖次商店取得联系
country_event = {
	id = wsgranking.998
	hide_window = yes
    is_triggered_only = yes
    trigger = {
        fromfrom = {
            is_country_type = pantsu_shop
        }
        NOT = { has_country_flag = establish_communicate_in_normal }
    }

    immediate = {
        country_event = { id = wsgranking.1000 }
    }

}

# 胖次科技研究后主动联络胖次商店
country_event = {
	id = wsgranking.999
	title = wsgranking.999.title
    desc = wsgranking.999.desc

    fire_only_once = yes
    is_triggered_only = yes

    trigger = {
        OR = {
            has_authority = auth_warshipgirls
            has_authority = auth_shenhai
        }
        is_ai = no
        last_increased_tech = tech_wsg_pantsu
    }

    immediate = {
        # 防止事件重复发生
        set_country_flag = establish_communicate_in_normal
    }

    after = {
        if = {
			limit = { NOT = { has_communications = event_target:pantsu_shop_country } }
			establish_communications_no_message = event_target:pantsu_shop_country
		}
        country_event = { id = wsgranking.1000 }
        country_event = { id = wsgranking.20001 }
    }

    option = {
        name = wsgranking.999.a
    }
}

country_event = {
	id = wsgranking.20001
	is_triggered_only = yes
	hide_window = yes
	trigger = {
        has_communications = event_target:pantsu_shop_country
        NOT = { has_country_flag = set_buff_limits }
	}
	immediate = {
        set_country_flag = set_buff_limits
		set_variable = {
			which = max_allowed_shop_buffs
			value = 2
		}
	}
}

country_event = {
	id = wsgranking.20002
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		change_variable = {
			which = max_allowed_shop_buffs
			value = 1
		}
	}
}

# 初次介绍
country_event = {
	id = wsgranking.1000
	title = "TRANSMISSION"
	desc = wsgranking.1000.desc
    custom_gui = "enclave_caravaneer_window"
	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # 有需求的话自己改名字
		room = Shop_room
	}

    immediate = {
        remove_country_flag = establish_communicate_in_normal
        add_tech_progress = {
            tech = tech_wsg_trading_pantsu
            progress = 0.25
        }
    }

    # 进入一级菜单
	option = { 
        custom_gui = "enclave_caravaneer_option"
        trigger = { OR = {
            has_authority = auth_warshipgirls
            has_authority = auth_shenhai
        }}
		name = wsgranking.1000.a
		hidden_effect = {
			country_event = { id = wsgranking.1004 }
		}
	}

    # 退出
	option = { 
        custom_gui = "enclave_caravaneer_option"
        trigger = { OR = {
            has_authority = auth_warshipgirls
            has_authority = auth_shenhai
        }}
		name = wsgranking.1000.b
	}
}

# 打开商店的主界面
country_event = {
	id = wsgranking.1001
	title = "TRANSMISSION"
    custom_gui = "enclave_caravaneer_window"
    trigger = {
        OR = {
            has_authority = auth_shenhai
            has_authority = auth_warshipgirls
        }
        exists = event_target:pantsu_shop_country
        event_target:pantsu_shop_country = {
            NOT = { is_hostile = root }
        }
        NOT = { has_country_flag = pantsu_shop_cooldown }
        OR = { 
            #防止视窗多开
			pantsu_shop_active_diplo = no 
			from = { is_same_value = root } # returning from open sub-menu
		}
        from = { OR = {
            is_country_type = pantsu_shop
            is_same_value = root # returned from menu
        }}
        is_ai = no
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 介绍1
	desc = { text = pantsu_shop_hello1 }

    # 介绍2
	desc = { text = pantsu_shop_hello2 }

    # 介绍3
	desc = { text = pantsu_shop_hello3 }

    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
	}

    # 询问军阶点数。
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1001.a
        response_text = wsgranking.1001.a.response
        is_dialog_only = yes
    }

    # 进入兑换。选项：兑换科技/兑换修正/兑换杂项资源。
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1001.b
        hidden_effect = {
            country_event = { id = wsgranking.1004 }
        }
    }

    # 退出
    option = { 
    custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}
#冷却期间打开胖次商店
country_event = {
	id = wsgranking.1002
	title = "TRANSMISSION"
    custom_gui = "enclave_caravaneer_window"
    trigger = {
        OR = {
            has_authority = auth_shenhai
            has_authority = auth_warshipgirls
        }
        exists = event_target:pantsu_shop_country
        has_country_flag = pantsu_shop_cooldown
        event_target:pantsu_shop_country = {
            NOT = { is_hostile = root }
        }
        OR = { 
            #防止视窗多开
			pantsu_shop_active_diplo = no 
			from = { is_same_value = root } # returning from open sub-menu
		}
        from = { OR = {
            is_country_type = pantsu_shop
            is_same_value = root # returned from menu
        }}
        is_ai = no
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 介绍1
	desc = { text = pantsu_shop_cooldown_desc }

    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
	}

    # 退出
    option = { 
    custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}


# 非舰娘帝国点进胖次商店
country_event = {
    id = wsgranking.1101
	title = wsgranking.1101.title
    desc = wsgranking.1101.desc

    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    is_triggered_only = yes

    picture_event_data = {
        room = Shop_room
    }
    
    trigger = {
        NOR = {
            has_authority = auth_shenhai
            has_authority = auth_warshipgirls
        }
        from = { is_country_type = pantsu_shop }
        NOT = { has_global_flag = pantsu_shop_disabled }
    }
    
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = OK
    }
}

# 敌对时联络
country_event = {
    id = wsgranking.1003
	title = "TRANSMISSION"
    desc = wsgranking.1003.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    is_triggered_only = yes
    picture_event_data = {
        room = Shop_room
    }
    
    trigger = {
        from = { is_country_type = pantsu_shop }
        OR = {
            has_authority = auth_shenhai
            has_authority = auth_warshipgirls
        }
        exists = event_target:pantsu_shop_country
        event_target:pantsu_shop_country = {
            is_hostile = root
        }
        NOT = { has_active_event = { wsgranking.1003 }}
        OR = { # prevents diplo duplication
			pantsu_shop_active_diplo = no 
			from = { is_same_value = root } # returning from open sub-menu
		}
        is_ai = no
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 预留了一下恢复和平的选项
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1003.a
        trigger = {
            # 显示条件
        }
        allow = {
            # 允许选择的条件
        }
        set_faction_hostility = {
            target = from
            set_hostile = no 
            set_neutral = yes
            set_friendly = no
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
    
}

# 一级界面 - 进入兑换。
country_event = {
	id = wsgranking.1004
	title = "TRANSMISSION"
	desc = wsgranking.1004.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

    trigger = {
        OR = { 
            #防止视窗多开
			pantsu_shop_active_diplo = no 
			from = { is_same_value = root } # returning from open sub-menu
        }
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
	}

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换科技
        name = wsgranking.1004.a
        hidden_effect = {
            country_event = { id = wsgranking.1005 }
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换修正
        name = wsgranking.1004.b
        hidden_effect = {
            #country_event = { id = wsgranking.1006 }
            country_event = { id = wsgranking.1007 }
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换杂项资源
        name = wsgranking.1004.c
        hidden_effect = {
            #country_event = { id = wsgranking.1008 }
            country_event = { id = wsgranking.1009 }
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 买戒指
        name = wsgranking.1004.d
        hidden_effect = {
            country_event = { id = wsgranking.1010 }
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        # 取消所有货物协议
        name = end_all_contract
        trigger = { OR = {
            has_modifier = pantsu_shop_dark_matter_contract
            has_modifier = pantsu_shop_zro_contract
            has_modifier = pantsu_shop_living_metal_contract
            has_modifier = pantsu_shop_nanites_contract
            has_modifier = pantsu_shop_alpha_contract
            has_modifier = pantsu_shop_se_contract
            has_modifier = pantsu_shop_dark_matter_contract_massive
            has_modifier = pantsu_shop_zro_contract_massive
            has_modifier = pantsu_shop_living_metal_contract_massive
            has_modifier = pantsu_shop_nanites_contract_massive
            has_modifier = pantsu_shop_alpha_contract_massive
            has_modifier = pantsu_shop_se_contract_massive
        }}
        hidden_effect = { country_event = { id = wsgranking.1017 }}
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

# 二级菜单 - 兑换科技
country_event = {
	id = wsgranking.1005
	title = "TRANSMISSION"
	desc = wsgranking.1005.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换科技
        name = tech_wsg_auto152
        # 科技前置条件
        trigger = {
            has_technology = tech_wsg_203
            NOT = {
                has_technology = tech_wsg_auto152
            }
        }
        # 资源花费
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value > 3000 }
            resource_stockpile_compare = { resource = sr_alpha value > 1500 }
            custom_tooltip = {
				fail_text = too_low_rank_fail
				check_variable = { which = "rankpts" value > 150 }
			}
        }
        add_resource = {
            sr_pantsu = -3000
            sr_alpha = -1500
        }
        #change_variable = { which = "rankpts" value = -893 }
        add_research_option = tech_wsg_auto152
        add_tech_progress = { tech = tech_wsg_auto152 progress = 0.1 }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换科技
        name = tech_wsg_203plasma
        # 科技前置条件
        trigger = {
            has_technology = tech_wsg_203
            NOT = {
                has_technology = tech_wsg_203plasma
            }
        }
        # 资源花费
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value > 2500 }
            resource_stockpile_compare = { resource = sr_alpha value > 1000 }
            custom_tooltip = {
				fail_text = too_low_rank_fail
				check_variable = { which = "rankpts" value > 140 }
			}
        }
        add_resource = {
            sr_pantsu = -2500
            sr_alpha = -1000
        }
        #change_variable = { which = "rankpts" value = -140 }
        add_research_option = tech_wsg_203plasma
        add_tech_progress = { tech = tech_wsg_203plasma progress = 0.1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换科技
        name = tech_wsg_356laser
        # 科技前置条件
        trigger = {
            has_technology = tech_wsg_203
            NOT = {
                has_technology = tech_wsg_356laser
            }
        }
        # 资源花费
        allow = {
            resource_stockpile_compare = { resource = sr_pantsu value > 2500 }
            resource_stockpile_compare = { resource = sr_alpha value > 1000 }
            custom_tooltip = {
				fail_text = too_low_rank_fail
				check_variable = { which = "rankpts" value > 130 }
			}
        }
        add_resource = {
            sr_pantsu = -2500
            sr_alpha = -1000
        }
        #change_variable = { which = "rankpts" value = -893 }
        add_research_option = tech_wsg_356laser
        add_tech_progress = { tech = tech_wsg_356laser progress = 0.1 }
    }


    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1004 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

# 产生随机购买清单
country_event = {
	id = wsgranking.1006
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_country_flag = generated_mod_random_list }
    }

    immediate = {
        set_timed_country_flag = { flag = generated_mod_random_list days = 360 }
        while = { count = 3
            random_list = {
                # 用随机列表来产生有时限的flag，然后用flag来判定哪些东西被抽中了
                # 时限就是刷新CD
                1 = { set_timed_country_flag = { flag = wsgrank_mod1 days = 360 }}
                1 = {}
            }
        }
    }
}

# 二级菜单 - 兑换修正
country_event = {
	id = wsgranking.1007
	title = "TRANSMISSION"
	desc = wsgranking.1007.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 兑换科技
        name = eyes_power
        # 前置条件
        trigger = {
            has_country_flag = wsgrank_mod1
        }
        # 资源花费
        allow = {
            check_variable = { which = "rankpts" value > 893 }
        }
        change_variable = { which = "rankpts" value = -893 }
        add_modifier = { modifier = eyes_power days = -1}
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1004 }
        }
    }

    # 返回主选单
    option = { custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

# 产生随机购买清单 - 待用
country_event = {
	id = wsgranking.1008
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_country_flag = generated_item_random_list }
    }

    immediate = {
        set_timed_country_flag = { flag = generated_item_random_list days = 360 }
        while = { 
            count = 3
            random_list = {
                # 用随机列表来产生有时限的flag，然后用flag来判定哪些东西被抽中了
                # 时限就是刷新CD
                1 = { set_timed_country_flag = { flag = wsgrank_item1 days = 360 }}
                1 = {}
            }
        }
    }
}

# 二级菜单 - 兑换杂项资源
country_event = {
	id = wsgranking.1009
	title = "TRANSMISSION"
	desc = wsgranking.1009.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 一次性兑换资源
        name = wsgranking.1009.a
        hidden_effect = {
            country_event = { id = wsgranking.1011 }
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 长期资源交易
        name = wsgranking.1009.b
        trigger = { NAND = {
            has_modifier = pantsu_shop_dark_matter_contract
            has_modifier = pantsu_shop_zro_contract
            has_modifier = pantsu_shop_living_metal_contract
            has_modifier = pantsu_shop_nanites_contract
            has_modifier = pantsu_shop_alpha_contract
            has_modifier = pantsu_shop_se_contract
            has_modifier = pantsu_shop_dark_matter_contract_massive
            has_modifier = pantsu_shop_zro_contract_massive
            has_modifier = pantsu_shop_living_metal_contract_massive
            has_modifier = pantsu_shop_nanites_contract_massive
            has_modifier = pantsu_shop_alpha_contract_massive
            has_modifier = pantsu_shop_se_contract_massive
        }}
        allow = {
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        hidden_effect = {
            if = {
                limit = { NAND = {
                    has_modifier = pantsu_shop_dark_matter_contract
                    has_modifier = pantsu_shop_zro_contract
                    has_modifier = pantsu_shop_living_metal_contract
                    has_modifier = pantsu_shop_nanites_contract
                    has_modifier = pantsu_shop_alpha_contract
                    has_modifier = pantsu_shop_se_contract
                }}
                country_event = { id = wsgranking.1014 }
            } else = {
                country_event = { id = wsgranking.1015 }
            }
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        # 取消货物协议
        name = end_contract
        trigger = { OR = {
            has_modifier = pantsu_shop_dark_matter_contract
            has_modifier = pantsu_shop_zro_contract
            has_modifier = pantsu_shop_living_metal_contract
            has_modifier = pantsu_shop_nanites_contract
            has_modifier = pantsu_shop_alpha_contract
            has_modifier = pantsu_shop_se_contract
            has_modifier = pantsu_shop_dark_matter_contract_massive
            has_modifier = pantsu_shop_zro_contract_massive
            has_modifier = pantsu_shop_living_metal_contract_massive
            has_modifier = pantsu_shop_nanites_contract_massive
            has_modifier = pantsu_shop_alpha_contract_massive
            has_modifier = pantsu_shop_se_contract_massive
        }}
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        # 取消所有货物协议
        name = end_all_contract
        trigger = { OR = {
            has_modifier = pantsu_shop_dark_matter_contract
            has_modifier = pantsu_shop_zro_contract
            has_modifier = pantsu_shop_living_metal_contract
            has_modifier = pantsu_shop_nanites_contract
            has_modifier = pantsu_shop_alpha_contract
            has_modifier = pantsu_shop_se_contract
            has_modifier = pantsu_shop_dark_matter_contract_massive
            has_modifier = pantsu_shop_zro_contract_massive
            has_modifier = pantsu_shop_living_metal_contract_massive
            has_modifier = pantsu_shop_nanites_contract_massive
            has_modifier = pantsu_shop_alpha_contract_massive
            has_modifier = pantsu_shop_se_contract_massive
        }}
        hidden_effect = { country_event = { id = wsgranking.1017 }}
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1004 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

# 三级菜单 - 兑换一次性资源 - 少量
country_event = {
	id = wsgranking.1011
	title = "TRANSMISSION"
	desc = wsgranking.1011.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 切换为中量
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1011.a
        hidden_effect = {
            country_event = { id = wsgranking.1012 }
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2dm
        trigger = { has_technology = tech_mine_dark_matter }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 500 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = dark_matter_stock value > 200 }
                }
                fail_text = dark_matter_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = dark_matter_stock value = -200 }}
        add_resource = {
            sr_pantsu = -500
            sr_dark_matter = 200
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2zro
        trigger = { has_technology = tech_mine_zro }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 500 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = zro_stock value > 200 }
                }
                fail_text = zro_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = zro_stock value = -200 }}
        add_resource = {
            sr_pantsu = -500
            sr_zro = 200
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2lm
        trigger = { has_technology = tech_mine_living_metal }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 500 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = living_metal_stock value > 200 }
                }
                fail_text = living_metal_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = living_metal_stock value = -200 }}
        add_resource = {
            sr_pantsu = -500
            sr_living_metal = 200
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2nanite
        trigger = { has_technology = tech_nanite_transmutation }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 500 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = nanite_stock value > 20 }
                }
                fail_text = nanite_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = nanite_stock value = -20 }}
        add_resource = {
            sr_pantsu = -500
            nanites = 20
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2alpha
        trigger = { has_technology = tech_building_wsg_alpha }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 500 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = alpha_stock value > 100 }
                }
                fail_text = alpha_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = alpha_stock value = -100 }}
        add_resource = {
            sr_pantsu = -500
            sr_alpha = 100
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2se
        trigger = { has_technology = tech_sh_senergy }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 500 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = se_stock value > 100 }
                }
                fail_text = se_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = se_stock value = -100 }}
        add_resource = {
            sr_pantsu = -500
            sr_se = 100
        }
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

# 三级菜单 - 兑换一次性资源 - 中量
country_event = {
	id = wsgranking.1012
	title = "TRANSMISSION"
	desc = wsgranking.1011.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 切换为中量
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1012.a
        hidden_effect = {
            country_event = { id = wsgranking.1013 }
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2dm
        trigger = { has_technology = tech_mine_dark_matter }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 2000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = dark_matter_stock value > 900 }
                }
                fail_text = dark_matter_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = dark_matter_stock value = -900 }}
        add_resource = {
            sr_pantsu = -2000
            sr_dark_matter = 900
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2zro
        trigger = { has_technology = tech_mine_zro }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 2000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = zro_stock value > 900 }
                }
                fail_text = zro_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = zro_stock value = -900 }}
        add_resource = {
            sr_pantsu = -2000
            sr_zro = 900
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2lm
        trigger = { has_technology = tech_mine_living_metal }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 2000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = living_metal_stock value > 900 }
                }
                fail_text = living_metal_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = living_metal_stock value = -900 }}
        add_resource = {
            sr_pantsu = -2000
            sr_living_metal = 900
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2nanite
        trigger = { has_technology = tech_nanite_transmutation }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 2000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = nanite_stock value > 100 }
                }
                fail_text = nanite_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = nanite_stock value = -100 }}
        add_resource = {
            sr_pantsu = -2000
            nanites = 100
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2alpha
        trigger = { has_technology = tech_building_wsg_alpha }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 2000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = alpha_stock value > 500 }
                }
                fail_text = alpha_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = alpha_stock value = -500 }}
        add_resource = {
            sr_pantsu = -2000
            sr_alpha = 500
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2se
        trigger = { has_technology = tech_sh_senergy }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 2000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = se_stock value > 500 }
                }
                fail_text = se_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = se_stock value = -500 }}
        add_resource = {
            sr_pantsu = -2000
            sr_se = 500
        }
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

# 三级菜单 - 兑换一次性资源 - 大量
country_event = {
	id = wsgranking.1013
	title = "TRANSMISSION"
	desc = wsgranking.1011.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 切换为少量
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1013.a
        hidden_effect = {
            country_event = { id = wsgranking.1011 }
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2dm
        trigger = { has_technology = tech_mine_dark_matter }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 10000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = dark_matter_stock value > 5000 }
                }
                fail_text = dark_matter_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = dark_matter_stock value = -5000 }}
        add_resource = {
            sr_pantsu = -10000
            sr_dark_matter = 5000
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2zro
        trigger = { has_technology = tech_mine_zro }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 10000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = zro_stock value > 5000 }
                }
                fail_text = zro_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = zro_stock value = -5000 }}
        add_resource = {
            sr_pantsu = -10000
            sr_zro = 5000
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2lm
        trigger = { has_technology = tech_mine_living_metal }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 10000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = living_metal_stock value > 5000 }
                }
                fail_text = living_metal_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = living_metal_stock value = -5000 }}
        add_resource = {
            sr_pantsu = -10000
            sr_living_metal = 5000
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2nanite
        trigger = { has_technology = tech_nanite_transmutation }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 10000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = nanite_stock value > 700 }
                }
                fail_text = nanite_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = nanite_stock value = -700 }}
        add_resource = {
            sr_pantsu = -10000
            nanites = 700
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2alpha
        trigger = { has_technology = tech_building_wsg_alpha }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 10000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = alpha_stock value > 3000 }
                }
                fail_text = alpha_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = alpha_stock value = -3000 }}
        add_resource = {
            sr_pantsu = -10000
            sr_alpha = 3000
        }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        is_dialog_only = yes
        name = pantsu2se
        trigger = { has_technology = tech_sh_senergy }
        allow = { 
            resource_stockpile_compare = { resource = sr_pantsu value > 10000 }
            custom_tooltip = {
                event_target:pantsu_shop_country = {
                    check_variable = { which = se_stock value > 3000 }
                }
                fail_text = se_sold_out
            }
        }
        event_target:pantsu_shop_country = { change_variable = { which = se_stock value = -3000 }}
        add_resource = {
            sr_pantsu = -10000
            sr_se = 3000
        }
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}


#三级菜单 - 兑换长期资源贸易协议
country_event = {
	id = wsgranking.1014
	title = "TRANSMISSION"
	desc = wsgranking.1014.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1014.a
        trigger = {
            NAND = {
                has_modifier = pantsu_shop_dark_matter_contract_massive
                has_modifier = pantsu_shop_zro_contract_massive
                has_modifier = pantsu_shop_living_metal_contract_massive
                has_modifier = pantsu_shop_nanites_contract_massive
                has_modifier = pantsu_shop_alpha_contract_massive
                has_modifier = pantsu_shop_se_contract_massive
            }
        }
        allow = {
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        hidden_effect = { country_event = { id = wsgranking.1015 }}
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = end_contract
        trigger = { OR = {
            has_modifier = pantsu_shop_dark_matter_contract
            has_modifier = pantsu_shop_zro_contract
            has_modifier = pantsu_shop_living_metal_contract
            has_modifier = pantsu_shop_nanites_contract
            has_modifier = pantsu_shop_alpha_contract
            has_modifier = pantsu_shop_se_contract
            has_modifier = pantsu_shop_dark_matter_contract_massive
            has_modifier = pantsu_shop_zro_contract_massive
            has_modifier = pantsu_shop_living_metal_contract_massive
            has_modifier = pantsu_shop_nanites_contract_massive
            has_modifier = pantsu_shop_alpha_contract_massive
            has_modifier = pantsu_shop_se_contract_massive
        }}
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2dm_contract
        trigger = { 
            has_technology = tech_mine_dark_matter
            NOT = { has_modifier = pantsu_shop_dark_matter_contract }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_dark_matter_contract_massive }
            remove_modifier = pantsu_shop_dark_matter_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_dark_matter_contract days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2zro_contract
        trigger = { 
            has_technology = tech_mine_zro
            NOT = { has_modifier = pantsu_shop_zro_contract }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_zro_contract_massive }
            remove_modifier = pantsu_shop_zro_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_zro_contract days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2lm_contract
        trigger = { 
            has_technology = tech_mine_living_metal 
            NOT = { has_modifier = pantsu_shop_living_metal_contract }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_living_metal_contract_massive }
            remove_modifier = pantsu_shop_living_metal_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_living_metal_contract days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2nanite_contract
        trigger = { 
            has_technology = tech_nanite_transmutation 
            NOT = { has_modifier = pantsu_shop_nanites_contract }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_nanites_contract_massive }
            remove_modifier = pantsu_shop_nanites_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_nanites_contract days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2alpha_contract
        trigger = { 
            has_technology = tech_building_wsg_alpha 
            NOT = { has_modifier = pantsu_shop_alpha_contract }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_alpha_contract_massive }
            remove_modifier = pantsu_shop_alpha_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_alpha_contract days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2se_contract
        trigger = { 
            has_technology = tech_sh_senergy 
            NOT = { has_modifier = pantsu_shop_se_contract }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 30 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_se_contract_massive }
            remove_modifier = pantsu_shop_se_contract_massive
        }
        add_modifier = { modifier = pantsu_shop_se_contract days = -1 }
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

#三级菜单 - 兑换长期资源贸易协议 - 大量
country_event = {
	id = wsgranking.1015
	title = "TRANSMISSION"
	desc = wsgranking.1014.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1015.a
        trigger = {
            NAND = {
                has_modifier = pantsu_shop_dark_matter_contract
                has_modifier = pantsu_shop_zro_contract
                has_modifier = pantsu_shop_living_metal_contract
                has_modifier = pantsu_shop_nanites_contract
                has_modifier = pantsu_shop_alpha_contract
                has_modifier = pantsu_shop_se_contract
            }
        }
        allow = {
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        hidden_effect = { country_event = { id = wsgranking.1014 }}
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = end_contract
        trigger = { OR = {
            has_modifier = pantsu_shop_dark_matter_contract
            has_modifier = pantsu_shop_zro_contract
            has_modifier = pantsu_shop_living_metal_contract
            has_modifier = pantsu_shop_nanites_contract
            has_modifier = pantsu_shop_alpha_contract
            has_modifier = pantsu_shop_se_contract
            has_modifier = pantsu_shop_dark_matter_contract_massive
            has_modifier = pantsu_shop_zro_contract_massive
            has_modifier = pantsu_shop_living_metal_contract_massive
            has_modifier = pantsu_shop_nanites_contract_massive
            has_modifier = pantsu_shop_alpha_contract_massive
            has_modifier = pantsu_shop_se_contract_massive
        }}
        hidden_effect = { country_event = { id = wsgranking.1016 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2dm_contract
        trigger = { 
            has_technology = tech_mine_dark_matter
            NOT = { has_modifier = pantsu_shop_dark_matter_contract_massive }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_dark_matter_contract }
            remove_modifier = pantsu_shop_dark_matter_contract
        }
        add_modifier = { modifier = pantsu_shop_dark_matter_contract_massive days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2zro_contract
        trigger = { 
            has_technology = tech_mine_zro
            NOT = { has_modifier = pantsu_shop_zro_contract_massive }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_zro_contract }
            remove_modifier = pantsu_shop_zro_contract
        }
        add_modifier = { modifier = pantsu_shop_zro_contract_massive days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2lm_contract
        trigger = { 
            has_technology = tech_mine_living_metal 
            NOT = { has_modifier = pantsu_shop_living_metal_contract_massive }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_living_metal_contract }
            remove_modifier = pantsu_shop_living_metal_contract
        }
        add_modifier = { modifier = pantsu_shop_living_metal_contract_massive days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2nanite_contract
        trigger = { 
            has_technology = tech_nanite_transmutation 
            NOT = { has_modifier = pantsu_shop_nanites_contract_massive }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_nanites_contract }
            remove_modifier = pantsu_shop_nanites_contract
        }
        add_modifier = { modifier = pantsu_shop_nanites_contract_massive days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2alpha_contract
        trigger = { 
            has_technology = tech_building_wsg_alpha 
            NOT = { has_modifier = pantsu_shop_alpha_contract_massive }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_alpha_contract }
            remove_modifier = pantsu_shop_alpha_contract
        }
        add_modifier = { modifier = pantsu_shop_alpha_contract_massive days = -1 }
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu2se_contract
        trigger = { 
            has_technology = tech_sh_senergy 
            NOT = { has_modifier = pantsu_shop_se_contract }
        }
        allow = { 
            resource_income_compare = { resource = sr_pantsu value >= 100 }
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        if = {
            limit = { has_modifier = pantsu_shop_se_contract }
            remove_modifier = pantsu_shop_se_contract
        }
        add_modifier = { modifier = pantsu_shop_se_contract_massive days = -1 }
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

#三级菜单 - 终止贸易
country_event = {
	id = wsgranking.1016
	title = "TRANSMISSION"
	desc = wsgranking.1016.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        # 长期资源交易
        name = wsgranking.1009.b
        trigger = { NAND = {
            has_modifier = pantsu_shop_dark_matter_contract
            has_modifier = pantsu_shop_zro_contract
            has_modifier = pantsu_shop_living_metal_contract
            has_modifier = pantsu_shop_nanites_contract
            has_modifier = pantsu_shop_alpha_contract
            has_modifier = pantsu_shop_se_contract
            has_modifier = pantsu_shop_dark_matter_contract_massive
            has_modifier = pantsu_shop_zro_contract_massive
            has_modifier = pantsu_shop_living_metal_contract_massive
            has_modifier = pantsu_shop_nanites_contract_massive
            has_modifier = pantsu_shop_alpha_contract_massive
            has_modifier = pantsu_shop_se_contract_massive
        }}
        allow = {
            custom_tooltip = {
                NOT = { has_country_flag = pantsu_shop_contract_break }
                fail_text = prohibit_contract_sign
            }
        }
        hidden_effect = {
            if = {
                limit = { NAND = {
                    has_modifier = pantsu_shop_dark_matter_contract
                    has_modifier = pantsu_shop_zro_contract
                    has_modifier = pantsu_shop_living_metal_contract
                    has_modifier = pantsu_shop_nanites_contract
                    has_modifier = pantsu_shop_alpha_contract
                    has_modifier = pantsu_shop_se_contract
                }}
                country_event = { id = wsgranking.1014 }
            } else = {
                country_event = { id = wsgranking.1015 }
            }
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        # 取消所有货物协议
        name = end_all_contract
        trigger = { OR = {
            has_modifier = pantsu_shop_dark_matter_contract
            has_modifier = pantsu_shop_zro_contract
            has_modifier = pantsu_shop_living_metal_contract
            has_modifier = pantsu_shop_nanites_contract
            has_modifier = pantsu_shop_alpha_contract
            has_modifier = pantsu_shop_se_contract
            has_modifier = pantsu_shop_dark_matter_contract_massive
            has_modifier = pantsu_shop_zro_contract_massive
            has_modifier = pantsu_shop_living_metal_contract_massive
            has_modifier = pantsu_shop_nanites_contract_massive
            has_modifier = pantsu_shop_alpha_contract_massive
            has_modifier = pantsu_shop_se_contract_massive
        }}
        hidden_effect = { country_event = { id = wsgranking.1017 }}
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.a
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_dark_matter_contract
                has_modifier = pantsu_shop_dark_matter_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_dark_matter_contract
        remove_modifier = pantsu_shop_dark_matter_contract_massive
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.b
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_zro_contract
                has_modifier = pantsu_shop_zro_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_zro_contract
        remove_modifier = pantsu_shop_zro_contract_massive
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.c
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_living_metal_contract
                has_modifier = pantsu_shop_living_metal_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_living_metal_contract
        remove_modifier = pantsu_shop_living_metal_contract_massive
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.d
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_nanites_contract
                has_modifier = pantsu_shop_nanites_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_nanites_contract
        remove_modifier = pantsu_shop_nanites_contract_massive
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.e
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_alpha_contract 
                has_modifier = pantsu_shop_alpha_contract_massive 
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_alpha_contract
        remove_modifier = pantsu_shop_alpha_contract_massive
    }
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1016.f
        trigger = { 
            OR = {
                has_modifier = pantsu_shop_se_contract 
                has_modifier = pantsu_shop_se_contract_massive
            }
        }
        is_dialog_only = yes
        response_text = comfirm_cancellation
        remove_modifier = pantsu_shop_se_contract
        remove_modifier = pantsu_shop_se_contract_massive
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

# 确认取消所有协议
country_event = {
	id = wsgranking.1017
	title = "TRANSMISSION"
	desc = wsgranking.1017.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
        # room 有需求的话自己改名字
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    # 确认取消所有协议
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1017.a
        remove_modifier = pantsu_shop_dark_matter_contract
        remove_modifier = pantsu_shop_dark_matter_contract_massive
        remove_modifier = pantsu_shop_zro_contract
        remove_modifier = pantsu_shop_zro_contract_massive
        remove_modifier = pantsu_shop_living_metal_contract
        remove_modifier = pantsu_shop_living_metal_contract_massive
        remove_modifier = pantsu_shop_nanites_contract
        remove_modifier = pantsu_shop_nanites_contract_massive
        remove_modifier = pantsu_shop_alpha_contract
        remove_modifier = pantsu_shop_alpha_contract_massive
        remove_modifier = pantsu_shop_se_contract
        remove_modifier = pantsu_shop_se_contract_massive
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1009 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

country_event = {
    id = wsgranking.1018
    title = "TRANSMISSION"
	desc = wsgranking.1010.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }

    trigger = {
        resource_stockpile_compare = { resource = sr_pantsu value <= 0 }
        OR = {
            has_modifier = pantsu_shop_dark_matter_contract
            has_modifier = pantsu_shop_zro_contract
            has_modifier = pantsu_shop_living_metal_contract
            has_modifier = pantsu_shop_nanites_contract
            has_modifier = pantsu_shop_alpha_contract
            has_modifier = pantsu_shop_se_contract
            has_modifier = pantsu_shop_dark_matter_contract_massive
            has_modifier = pantsu_shop_zro_contract_massive
            has_modifier = pantsu_shop_living_metal_contract_massive
            has_modifier = pantsu_shop_nanites_contract_massive
            has_modifier = pantsu_shop_alpha_contract_massive
            has_modifier = pantsu_shop_se_contract_massive
        }
    }

    option = {
        name = wsgranking.1018.a
        response_text = wsgranking.1018.a.response
        remove_modifier = pantsu_shop_dark_matter_contract
        remove_modifier = pantsu_shop_dark_matter_contract_massive
        remove_modifier = pantsu_shop_zro_contract
        remove_modifier = pantsu_shop_zro_contract_massive
        remove_modifier = pantsu_shop_living_metal_contract
        remove_modifier = pantsu_shop_living_metal_contract_massive
        remove_modifier = pantsu_shop_nanites_contract
        remove_modifier = pantsu_shop_nanites_contract_massive
        remove_modifier = pantsu_shop_alpha_contract
        remove_modifier = pantsu_shop_alpha_contract_massive
        remove_modifier = pantsu_shop_se_contract
        remove_modifier = pantsu_shop_se_contract_massive
        add_modifier = { modifier = pantsu_shop_contract_break days = 1440 }
        set_timed_country_flag = { flag = pantsu_shop_contract_break days = 3600 }
    }
}

country_event = {
    id = wsgranking.1998
    hide_window = yes

    trigger = {
        is_country_type = pantsu_shop
    }

    mean_time_to_happen = {
        years = 10
        modifier = {
            factor = 0.5
            check_variable = { which = rings_stock value < 2 }
        }
        modifier = {
            factor = 0.2
            check_variable = { which = rings_stock value < 1 }
        }
    }

    immediate = {
        if = {
            limit = { check_variable = { which = rings_stock value < 3 }}
            random_list = {
                1 = {
                    change_variable = { which = rings_stock value = 1 }
                }
                2 = {
                    modifier = {
                        add = -1
                        check_variable = { which = rings_stock value < 1 }
                    }
                }
            }
        }
    }
}

country_event = {
    id = wsgranking.1999
    hide_window = yes

    trigger = {
        is_country_type = pantsu_shop
    }

    mean_time_to_happen = {
        months = 3
    }

    immediate = {
        if = {
            limit = { check_variable = { which = dark_matter_stock value < 30000 }}
            if = {
                limit = { check_variable = { which = dark_matter_stock value < 5000 }}
                change_variable = { which = dark_matter_stock value = 1500 }
            } else = {
                change_variable = { which = dark_matter_stock value = 600 }
            }
        }
        if = {
            limit = { check_variable = { which = living_metal_stock value < 30000 }}
            if = {
                limit = { check_variable = { which = living_metal_stock value < 5000 }}
                change_variable = { which = living_metal_stock value = 1500 }
            } else = {
                change_variable = { which = living_metal_stock value = 600 }
            }
        }
        if = {
            limit = { check_variable = { which = zro_stock value < 30000 }}
            if = {
                limit = { check_variable = { which = zro_stock value < 5000 }}
                change_variable = { which = zro_stock value = 1500 }
            } else = {
                change_variable = { which = zro_stock value = 600 }
            }
        }
        if = {
            limit = { check_variable = { which = nanite_stock value < 10000 }}
            if = {
                limit = { check_variable = { which = nanite_stock value < 700 }}
                change_variable = { which = nanite_stock value = 250 }
            } else = {
                change_variable = { which = nanite_stock value = 100 }
            }
        }
        if = {
            limit = { check_variable = { which = alpha_stock value < 20000 }}
            if = {
                limit = { check_variable = { which = alpha_stock value < 6000 }}
                change_variable = { which = alpha_stock value = 2000 }
            } else = {
                change_variable = { which = alpha_stock value = 800 }
            }
        }
        if = {
            limit = { check_variable = { which = se_stock value < 20000 }}
            if = {
                limit = { check_variable = { which = se_stock value < 6000 }}
                change_variable = { which = se_stock value = 2000 }
            } else = {
                change_variable = { which = se_stock value = 800 }
            }
        }
    }
}



#二级菜单 - 购买戒指
country_event = {
	id = wsgranking.1010
	title = "TRANSMISSION"
	desc = wsgranking.1010.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		room = Shop_room
    }
    
    trigger = {
        NOT = { has_global_flag = pantsu_shop_disabled }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1010.a
        # 前置条件
        trigger = {
            has_authority = auth_warshipgirls
        }
        # 限制条件
        allow = {
            resource_stockpile_compare = { resource = energy value > 6480 }
            resource_stockpile_compare = { resource = rare_crystals value > 648 }
            resource_stockpile_compare = { resource = sr_alpha value > 648 }
            resource_stockpile_compare = { resource = sr_pantsu value > 648 }
            custom_tooltip = {
                fail_text = not_enough_rings
                event_target:pantsu_shop_country = { 
                    check_variable = { which = rings_stock value > 0 }
                }
            }
        }
        hidden_effect = { change_variable = { which = "wsg_rings" value = 1 }}
        event_target:pantsu_shop_country = { 
            change_variable = { which = rings_stock value = -1 }
        }
        #消耗资源
        add_resource = {
            energy = -6480
            rare_crystals = -648
            sr_alpha = -648
            sr_pantsu = -648
        }
    }

    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.1010.a
        # 前置条件
        trigger = {
            has_authority = auth_shenhai
        }
        # 限制条件
        allow = {
            resource_stockpile_compare = { resource = energy value > 6480 }
            resource_stockpile_compare = { resource = rare_crystals value > 648 }
            resource_stockpile_compare = { resource = sr_se value > 648 }
            resource_stockpile_compare = { resource = sr_pantsu value > 648 }
            custom_tooltip = {
                fail_text = not_enough_rings
                event_target:pantsu_shop_country = { 
                    check_variable = { which = rings_stock value > 0 }
                }
            }
        }
        change_variable = { which = "wsg_rings" value = 1 }
        event_target:pantsu_shop_country = { 
            change_variable = { which = rings_stock value = -1 }
        }
        #消耗资源
        add_resource = {
            energy = -6480
            rare_crystals = -648
            sr_se = -648
            sr_pantsu = -648
        }
    }

    # 返回一级菜单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_menu
        hidden_effect = {
            country_event = { id = wsgranking.1004 }
        }
    }

    # 返回主选单
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_return_to_main
        hidden_effect = {
            country_event = { id = wsgranking.1001 }
        }
    }

    # 退出
    option = { 
        custom_gui = "enclave_caravaneer_option"
        name = pantsu_shop_exit
        default_hide_option = yes
    }
}

# 其他国家收到被摧毁消息
country_event = {
	id = wsgranking.2001
	title = wsgranking.2001.title
	desc = wsgranking.2001.desc
	picture = GFX_evt_space_debris
	show_sound = event_ship_bridge
	location = fromfromfrom

	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
	}

	option = {
		name = EXCELLENT
		exclusive_trigger = { 
            is_homicidal = yes 
        }
	}
}

# 有商店通讯之后随机被动增加军阶

country_event = {
	id = wsgranking.5001
	hide_window = yes
	mean_time_to_happen = {
		days = 720
	}
	trigger = {
		has_communications = event_target:pantsu_shop_country
		NOT = {
			has_country_flag = recent_rank_increment
		}
	}
	immediate = {
		set_timed_country_flag = {
			flag = recent_rank_increment
			days = 720
		}
	
	    random_list = {
            4 = {
                change_variable = {
                    which = rankpts
                    value = 2
                }
            }

            6 = {
                change_variable = {
                    which = rankpts
                    value = 1
                }
            }

            10 = {
            }
        }	
    }
}
# 任务增加军阶点（实验性）
#征集员工 - 1人口，4点数
country_event = {
	id = wsgranking.5001
	title = wsgranking.5001.title
	desc = wsgranking.5001.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    #is_triggered_only = yes
    picture_event_data = {
        room = Shop_room
    }
	
	mean_time_to_happen = {
		years = 30
		modifier = {
			factor = 1.2
			num_pops > 100
		}
		modifier = {
			factor = 1.2
			num_pops > 80
		}
		modifier = {
			factor = 1.2
			num_pops > 60
		}
		modifier = {
			factor = 1.2
			num_pops > 40
		}
		modifier = {
			factor = 0.5
			num_pops < 30
		}
		modifier = {
			factor = 0.5
			num_pops < 20
		}
	}
	
	trigger = {
		num_pops > 10
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
        has_communications = event_target:pantsu_shop_country
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_fanatic_purifiers
		}		
		is_at_war = no
		any_owned_planet = {
			num_pops > 1
			any_owned_pop = {
				is_same_species = root
			}
		}	
    }
	immediate = {	
		random_owned_planet = {
			limit = {
				num_pops > 1
				any_owned_pop = {
					is_same_species = root
				}
			}
			save_event_target_as = PantsuShopTaskPlanet
        }	
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5001.a
        change_variable = {
            which = rankpts
            value = 4
        }
        add_modifier = {
            modifier = extended_payout_goodest
            days = 7200
        }
        hidden_effect = {
			event_target:PantsuShopTaskPlanet = {
				random_pop = {
					limit = {
                    is_same_species = root
                    }
                    kill_pop = yes
                }	
		    }
        }
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5001.b
        #custom_tooltip = "name.tooltip"
    }
}

# 战利品商店投资

country_event = {
	id = wsgranking.5002
	title = wsgranking.5002.title
	desc = wsgranking.5002.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    #is_triggered_only = yes
    picture_event_data = {
        room = Shop_room
    }
	
	mean_time_to_happen = {
		years = 30
		modifier = {
            factor = 0.8
            AND = {
                resource_stockpile_compare = {
                    resource = energy
                    value = 10000
                }
                income > 500
            }
		}
		modifier = {
			factor = 0.5
            AND = {
                resource_stockpile_compare = {
                    resource = energy
                    value = 20000
                }
                income > 1000
            }
        }
        modifier = {
			factor = 0.2
            AND = {
                resource_stockpile_compare = {
                    resource = energy
                    value = 40000
                }
                income > 2000
            }
        }
	}
	immediate = {
        set_timed_country_flag = {
            flag = pantsu_shop_loan_requested
            days = 7200
        }
    }
	trigger = {
		num_pops > 10
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
        has_communications = event_target:pantsu_shop_country
		NOR = {
			has_valid_civic = civic_machine_terminator
            has_valid_civic = civic_fanatic_purifiers
            has_country_flag = pantsu_shop_loan_requested
		}		
		is_at_war = no
        resource_stockpile_compare = {
            resource = energy
            value = 5000
        }
    }
# 5年期5000投资，每月110
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5002.a
        allow = {
            resource_stockpile_compare = { resource = energy value >= 5000 }
        }
        change_variable = {
            which = rankpts
            value = 2
        }
        add_modifier = {
            modifier = wg_shop_loan_5k
            days = 1800
        }
        hidden_effect = {
			add_resource = {
                energy = -5000
            }
        }
    }
#10年期10000投资，每月167
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5002.b
        allow = {
            resource_stockpile_compare = { resource = energy value >= 10000 }
        }
        change_variable = {
            which = rankpts
            value = 4
        }

        add_modifier = {
            modifier = wg_shop_loan_10k
            days = 3600
        }
        hidden_effect = {
			add_resource = {
                energy = -10000
            }
        }
    }
#20年期30000投资，每月375
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5002.c
        allow = {
            resource_stockpile_compare = { resource = energy value >= 20000 }
        }
        change_variable = {
            which = rankpts
            value = 8
        }
        add_modifier = {
            modifier = wg_shop_loan_30k
            days = 7200
        }
        hidden_effect = {
            add_resource = {
                energy = -30000
            }
        }
    }


    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5002.d
    }
}

# 市场拓展任务 - 要求特许经营
country_event = {
	id = wsgranking.5003
	title = wsgranking.5003.title
	desc = wsgranking.5003.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    #is_triggered_only = yes
    picture_event_data = {
        room = Shop_room
    }
	
	mean_time_to_happen = {
		years = 40
		modifier = {
			factor = 0.6
			any_owned_planet = {
                has_building = building_pantsu_shop
            }	
        }
        modifier = {
			factor = 0.4
			any_owned_planet = {
                AND = {
                has_building = building_pantsu_shop
                has_building = building_galactic_stock_exchange
                }
            }	
		}
	}
	
	trigger = {
		num_pops > 10
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_fanatic_purifiers
		}		
		NOT = { has_country_flag = pantsu_shop_franchising }
		#is_at_war = no
		
		any_owned_planet = {
			num_pops > 50
			any_owned_pop = {
				is_same_species = root
			}
		}	
	}
	
	immediate = {
		set_timed_country_flag = {
            flag = pantsu_shop_franchising
            days = 14400
        }
	
		random_owned_planet = {
            limit = {
				num_pops > 50
			OR = {
                has_building = building_pantsu_shop
                has_building = building_commercial_zone
                has_building = building_galactic_stock_exchange
                has_building = building_commercial_megaplex
                }
			}
			save_event_target_as = pantsu_shop_franchising_planet
        }	
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5003.a
        change_variable = {
            which = rankpts
            value = 8
        }
        hidden_effect = {
            add_resource = {
                energy = 2000
            }
        }
        event_target:pantsu_shop_franchising_planet = {
            add_modifier = {
                modifier = pantsu_shop_franchising
                days = -1
            }
        }
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5003.b
    }
}


# 给断椅族改善伙食
country_event = {
	id = wsgranking.5004
	title = wsgranking.5004.title
	desc = wsgranking.5004.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    #is_triggered_only = yes
    picture_event_data = {
        room = Shop_room
    }
	
	mean_time_to_happen = {
		years = 10
		modifier = {
			factor = 0.6
            has_technology = tech_food_processing_2

        }
	}
	
	trigger = {
		is_gestalt = no
		is_mechanical_empire = no	
        is_country_type = default
        has_technology = tech_food_processing_1
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_fanatic_purifiers
		}		
        NOT = {
            has_country_flag = pantsu_shop_food_granted
        }
		#is_at_war = no
	}
	
	immediate = {
        set_timed_country_flag = {
            flag = pantsu_shop_food_granted
            days = 7200
        }
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5004.a
        change_variable = {
            which = rankpts
            value = 2
        }
        add_resource = {
            food = -1000
            volatile_motes = -50
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5004.b
        change_variable = {
            which = rankpts
            value = 2
        }
        add_resource = {
            food = -1000
            exotic_gases = -50
        }
    }

    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5004.c
        change_variable = {
            which = rankpts
            value = 2
        }
        add_resource = {
            food = -1000
            minor_artifacts = -1
        }
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5004.d
    }
}
#赠送奈拉总督
country_event = {
	id = wsgranking.5005
	title = wsgranking.5005.title
	desc = wsgranking.5005.desc
    custom_gui = "enclave_caravaneer_window"
    diplomatic = yes
    #is_triggered_only = yes
    picture_event_data = {
        room = Shop_room
    }
	
	mean_time_to_happen = {
		years = 30
		modifier = {
			factor = 0.6
            has_technology = tech_food_processing_2

        }
	}
	
	trigger = {
		is_gestalt = no
		is_mechanical_empire = no	
        is_country_type = default
        has_technology = tech_food_processing_1
        OR = {
			has_authority = auth_warshipgirls
			has_authority = auth_shenhai
		}
		NOR = {
			has_valid_civic = civic_machine_terminator
			has_valid_civic = civic_fanatic_purifiers
		}		
		#is_at_war = no
	}
	
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5005.a
        change_variable = {
            which = rankpts
            value = 2
        }
        hidden_effect = {		
            create_species = {
                name = NAILA
                plural = NAILA
                class = ART
                portrait = art13
                namelist = ART1
                effect = {
                    save_global_event_target_as = Naila_species
                }
            }		
            create_leader = {
                class = governor
                species = event_target:Naila_species
                name = "NAME_naila"
                skill = 5
                traits = {
                    trait = leader_trait_governor_naila
                    trait = leader_trait_governor_chairman
                }
                event_leader = yes	# prevents this leader from leading factions and winning elections
            }
            last_created_leader = {
                set_is_female = yes
                set_age = 9
                change_leader_portrait = cts9998
            }
        }	
    }
    option = {
        custom_gui = "enclave_caravaneer_option"
        name = wsgranking.5005.b
    }
}
#通知事件
#通知阿尔法武器上架
country_event = {
	id = wsgranking.6000
    hide_window = yes
    is_triggered_only = yes

    trigger = {
       has_technology = tech_wsg_203
    }

    immediate = {
        set_timed_country_flag = { flag = pantsu_shop_cooldown days = 10 }
    }
}
#通知基因科技可以购买
#通知军阶点数达到某几个关键值



# 商店被摧毁
# Fleet 2 - Destroyed by Default country
country_event = {
	# This = owner of fleet 1 (combatant)
	# From = owner of fleet 2 (destroyed)
	# FromFrom = fleet 1
	# FromFromFrom = fleet 2
	# on_fleet_destroyed_perp 
	id = wsgranking.2000
	title = wsgranking.2000.title
	desc = wsgranking.2000.desc
	picture = GFX_evt_caravaneers
	show_sound = event_ship_thrusters
	location = fromfrom

	is_triggered_only = yes

	trigger = {
        fromfromfrom = { has_fleet_flag = pantsu_shop_guard }
	}

	immediate = {
        set_global_flag = pantsu_shop_disabled
        clear_global_event_target = pantsu_shop_system
        # 非舰娘国家击破触发重建事件
        if = {
            limit = {
                NOR = { # 非舰娘国家击破
                    has_authority = auth_warshipgirls
                    has_authority = auth_shenhai
                }
                any_country = { #检查是否有国家符合搬迁条件
                    has_communications = event_target:pantsu_shop_country
                    OR = {
                        has_authority = auth_warshipgirls
                        has_authority = auth_shenhai
                    }
                    NOR = { 
                        is_hostile = event_target:pantsu_shop_country
                        has_country_flag = asked_for_immigration
                    }
                    is_ai = no
                }
                NOT = { has_global_flag = pantsu_shop_rebuilt } # 不能重建两次
            }
            random_country = {
                limit = { #搜索最近的可重建星系
                    has_communications = event_target:pantsu_shop_country
                    OR = {
                        has_authority = auth_warshipgirls
                        has_authority = auth_shenhai
                    }
                    NOR = { 
                        is_hostile = event_target:pantsu_shop_country
                        has_country_flag = asked_for_immigration
                    }
                    is_ai = no #首先搜索玩家
				}
				country_event = { id = wsgranking.2002 } # days should be 60
			}
            every_playable_country = { #通知胖次商店被炸掉
                limit = {
                    has_communications = event_target:pantsu_shop_country
                    NOT = { is_same_value = root }
                }
                country_event = { id = wsgranking.2001 } # notification
            }
        }
        else = {
            every_playable_country = { #通知胖次商店被炸掉而且跑了
                limit = {
                    has_communications = root.from
                    NOT = { is_same_value = root }
                }
                country_event = { id = wsgranking.2004 } # notification
            }
        }
	}

    # 击破者为普通帝国的选项
	option = { 
        trigger = { 
                NOR = {
                has_authority = auth_warshipgirls
                has_authority = auth_shenhai
            }
        }
		name = EXCELLENT
        # 干掉的奖励
		add_resource = {
			energy = 4000
			minerals = 4000
            #sr_pantsu = 200
		}
	}

    # 击破者为舰娘的选项
    option = {
        trigger = { OR = {
            has_authority = auth_warshipgirls
            has_authority = auth_shenhai
        }}
		name = EXCELLENT
        # 干掉的奖励
		add_resource = {
			energy = 2000
			minerals = 4000
            sr_pantsu = 400
		}
	}
}

# 询问该国家愿不愿意接受胖次商店入境
# 觉得不需要这个事件直接删掉就好
country_event = {
    id = wsgranking.2002
    title = wsgranking.2002.name
    desc = wsgranking.2002.desc
    picture = GFX_evt_federation_fleet
    location = root.capital_scope

    is_triggered_only = yes

    immediate = {
        set_country_flag = asked_for_immigration
    }

    option = { #接受
        name = wsgranking.2002.a
        country_event = { id = wsgranking.2003 }
        ai_chance = {
            factor = 999
        }
        hidden_effect = { remove_global_flag = pantsu_shop_disabled }
    }
    option = { #拒绝
        name = wsgranking.202.b
        hidden_effect = {
            if = {
                limit = {
                    any_country = {
                        has_communications = event_target:pantsu_shop_country
                        OR = {
                            has_authority = auth_warshipgirls
                            has_authority = auth_shenhai
                        }
                        NOR = { 
                            is_hostile = event_target:pantsu_shop_country
                            has_country_flag = asked_for_immigration
                        }
                    }
                }
                random_country = {
                    limit = { #搜索最近的可重建星系
                        OR = {
                            has_authority = auth_warshipgirls
                            has_authority = auth_shenhai
                        }
                        NOR = { 
                            is_hostile = event_target:pantsu_shop_country
                            has_country_flag = asked_for_immigration
                        }
                    }
                    country_event = { id = wsgranking.2002 } # days should be 60
                }
            }
            else = { # 没有找到备选国家，直接跑路
                every_country = {
                    limit = { is_country_type = default }
                    country_event = { id = wsgranking.2004 } # 通知胖次商店被毁，并且胖次商店跑路了
                    remove_country_flag = asked_for_immigration
                }
            }
        }
    }
}

# 重建事件
country_event = {
    id = wsgranking.2003
    title = wsgranking.2003.name
    desc = wsgranking.2003.desc
    picture = GFX_evt_caravaneers
    location = root.capital_scope

    is_triggered_only = yes

    immediate = {
        set_global_flag = pantsu_shop_rebuilt
        every_country = {
            limit = { has_country_flag = asked_for_immigration }
            remove_country_flag = asked_for_immigration
        }
        capital_scope = { solar_system = {
            random_system_planet = {
                limit = { 
                    is_star = no
                    NOT = { is_same_value = PREVPREV }
                }
                #搞点舰队啥的
                create_pantsu_shop_guard_fleets = yes
            }
            save_global_event_target_as = pantsu_shop_system
        }}
        remove_global_flag = pantsu_shop_disabled
    }

    option = {
        name = OK
    }
    
}

# 商店被炸掉并跑路的事件
country_event = {
    id = wsgranking.2004
    title = wsgranking.2004.name
    desc = wsgranking.2004.desc
    picture = GFX_evt_wsg_no_video

    is_triggered_only = yes

    immediate = {
        #event_target:pantsu_shop_country = {
        #    destroy_country = yes
        #}
    }

    option = {
        name = OK
    }
}